Цель. Политика «privacy by design/default» и права субъекта.

Принципы: обрабатывать по умолчанию только необходимые данные; ограничивать объём/срок/доступ. (GDPR Art.25.)

Рамка: EDPB Guidelines 4/2019 по «DPbDD» для выбора мер и гарантий.

Минимизация: нет текста заметок в MVP; храним mood, ts, pid; сырые chat_id отдельно в ident.

Права: /export (CSV), /delete_me (безоткатное удаление), контакт контроллера.

Секьюрность: вебхук с секрет-заголовком; доступ к БД по наименьшим правам.

Сроки хранения и TTL:
- mood/checkin записи и связанные pet-render события — автоматическое удаление записей старше 12 месяцев.
- идентификаторы (chat_id, pid link) — автоматическое удаление связок, не имеющих активности > 18 месяцев.
- журналы доступа и webhook-лог — ротация и удаление каждые 90 дней.

Механизм реализации TTL:
- Nightly Scheduler запускает фоновые cron-задачи `cleanup.checkin` и `cleanup.ident`.
- SQL-политики `DELETE FROM checkins WHERE created_at < now() - interval '12 months'` и аналогично для `idents`/`webhook_logs`.
- Scheduler пишет событие `cleanup.done` и журналирует объём удалённых строк.

Процесс /export:
1. Пользователь инициирует `/export`; Router подтверждает владение аккаунтом через код подтверждения в чате (одноразовый токен TTL=15 минут).
2. После подтверждения публикуется `export.request`; Export агент генерирует CSV (муд, ts, pid) и сохраняет во временное хранилище на 7 дней.
3. Пользователю отправляется ссылка/файл и уведомление о доступности выгрузки, а также контакты поддержки для вопросов.
4. Логи доступа к выгрузке хранятся 30 дней.

Процесс /delete_me:
1. Пользователь отправляет `/delete_me`; Router подтверждает намерение (двухшаговое подтверждение + код).
2. После подтверждения создаётся `delete.request`; Delete агент выполняет полное удаление checkins, идентификаторов, настроек.
3. Завершение фиксируется событием `delete.done`, пользователю отправляется уведомление об успешном удалении с указанием сроков распространения (до 24 часов).
4. Бэкапы шифруются и подлежат регулярной ротации; полное удаление из резервных копий — в течение 30 дней согласно процедуре из RUNBOOK.

Регулярный аудит удаления:
- Еженедельно ответственный за Scheduler (SRE, sre@emotiondiary.app) проверяет журнал задач (`scheduler.log`) на успешность `cleanup.*` и `delete.*` событий.
- Ежеквартально DPO (privacy@emotiondiary.app) проводит ручную выборочную проверку БД (audit.sql) на отсутствие просроченных записей.
- Результаты аудита документируются и хранятся минимум 1 год.

Ответственные лица и контакты контроллера данных:
- Data Controller: Emotion Diary OÜ, privacy@emotiondiary.app.
- DPO: Анна Иванова, dpo@emotiondiary.app.
- Инцидент-менеджер: on-call Security (pagerduty канал `sec-oncall`).

Процедура эскалации privacy-инцидентов:
- Любой участник команды фиксирует инцидент в ticketing-системе с тегом `privacy` и уведомляет on-call Security.
- On-call Security активирует RUNBOOK (см. RUNBOOK.md) для первичной оценки и containment.
- DPO уведомляет контроллера данных и, при необходимости, регулятора в сроки, описанные в SECURITY.md.
- Итоги расследования документируются и прикрепляются к инциденту, включая ссылки на использованные процедуры из RUNBOOK.md и SECURITY.md.
